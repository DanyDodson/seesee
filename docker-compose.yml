version: '3'
services:

  platform_pwa:
    build: platform/pwa
    container_name: platform_pwa
    restart: always
    volumes:
      - /home/node/app/node_modules
      - './platform/pwa:/home/node/app'
    depends_on:
      - gateway_proxy
    networks:
      - client_network

  subscribers_rabbitmq:
    image: rabbitmq:3-management-alpine 
    container_name: subscribers_rabbitmq
    environment:
      RABBITMQ_DEFAULT_USER: root
      RABBITMQ_DEFAULT_PASS: toor
    ports:
      - 5672:5672
      - 15672:15672

  gateway_proxy:
    build: gateway/proxy
    container_name: gateway_proxy
    restart: always
    ports:
      - '3050:80'
    depends_on:
      - users_service
      - profiles_service
      - posts_service
      - gateway_client
    networks:
      - client_network
      - secure_network
      
  gateway_client:
    build: gateway/client
    container_name: gateway_client
    restart: always
    volumes:
      - /home/node/app/node_modules
      - './gateway/client:/home/node/app'
    networks:
      - secure_network

  users_service:
    build: services/users
    container_name: users_service
    volumes:
      - /home/node/app/node_modules
      - './services/users:/home/node/app'
    networks:
      - secure_network

  profiles_service:
    build: services/profiles
    container_name: profiles_service
    volumes:
      - /home/node/app/node_modules
      - './services/profiles:/home/node/app'
    networks:
      - secure_network

  posts_service:
    build: services/posts
    container_name: posts_service
    volumes:
      - /home/node/app/node_modules
      - './services/posts:/home/node/app'
    networks:
      - secure_network

networks:
  client_network: null
  secure_network: null
